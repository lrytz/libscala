#!/usr/bin/env bash
#

[[ $# -eq 1 ]] || { echo "Usage: $0 <directory>"; exit 1; }

SUBDIR_NAME=$1
BRANCH_NAME=master

echo git filter-branch --index-filter \
    'git ls-files -s | \
        sed "s-\t-&'"$SUBDIR_NAME"'/-" | \
        GIT_INDEX_FILE=$GIT_INDEX_FILE.new \
        git update-index --index-info && \
        mv $GIT_INDEX_FILE.new $GIT_INDEX_FILE
  ' "$BRANCH_NAME"
